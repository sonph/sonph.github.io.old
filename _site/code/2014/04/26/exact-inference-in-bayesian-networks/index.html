<!DOCTYPE html>
<html>
    <head>
        <title>Exact inference in Bayesian networks</title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="description" content="Son Pham's personal site." />
        <meta name="keywords" content="" />

        <link href="/assets/img/favicon.ico" rel="icon" type="image/x-icon" />
        
        <!-- css styles and syntax coloring -->
        <link rel="stylesheet" href="/assets/css/style.css" />
        <link rel="stylesheet" href="/assets/css/syntax.css" />

        <!-- semantic ui -->
        <link rel="stylesheet" href="/assets/packaged/css/semantic.min.css" />
        <script src="/assets/packaged/javascript/semantic.min.js"></script>

        <!-- fonts -->
        <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300' rel='stylesheet' type='text/css'>
        <!-- <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'> -->
        <link href='http://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

    </head>
    <body>
        <div id="header">
        </div>
        <br class="clear">
        <nav id="topnav">
        </nav>
        <div id="container" class="ui content grid">
            <aside id="navmobile" class="mobile only row">
                <div>
                    <div style="display: inline-block;">
                        <a href="/about"><img src="/assets/img/profile120x120.png"></a>
                    </div>
                    &nbsp;&nbsp;
                    <div style="display: inline-block;">
                        <strong>Son Pham</strong>
                        <br>
                        <em>Software Engineer</em>
                    </div>
                </div>
                <br>
                <div>
                    <a href="/"><i class="square home icon"></i></a>
                    &nbsp; &nbsp;
                    <a href="/posts"><i class="square pencil icon"></i></a>
                    &nbsp; &nbsp;
                    <a href="/code"><i class="square code icon"></i></a>
                    &nbsp; &nbsp;
                    <a href="/about"><i class="square user icon"></i></a>
                </div>
                <br>
                <div>
                    <a target="_blank" href="https://github.com/sonph"><i class="square github sign icon"></i></a>
                    &nbsp; &nbsp;
                    <a target="_blank" href="https://linkedin.com/in/sonph"><i class="square linkedin sign icon"></i></a>
                    &nbsp; &nbsp;
                    <a target="_blank" href="https://facebook.com/s0nnyftw"><i class="square facebook sign icon"></i></a>
                    &nbsp; &nbsp;
                    <a target="_blank" href=""><i class="square mail icon"></i></a>
                </div>
            </aside>
            <aside id="side" class="four wide column"> 
                <div id="sideprofile">
                    <a href="/about"><img src="/assets/img/profile120x120.png"></a>
                    <br>
                    <strong>Son Pham</strong>
                    <br>
                    <em>Software Engineer</em>
                    <br><br>
                </div>
                <hr>
                <div id="sidenav">
                    <ul>
                        <li><a href="/">Home</a> &nbsp;<i class="home icon"></i></li>
                        <li><a href="/posts">Posts</a> &nbsp;<i class="pencil icon"></i></li>
                        <li><a href="/code">Code</a> &nbsp;<i class="code icon"></i></li>
                        <li><a href="/about">About</a> &nbsp;<i class="user icon"></i></li>
                    </ul>
                    <hr>
                    <ul>
                        <li><a href="https://github.com/sonph" target="_blank">GitHub</a> &nbsp;<i class="github sign icon"></i></li>
                        <li><a href="https://linkedin.com/in/sonph" target="_blank">LinkedIn</a> &nbsp;<i class="linkedin sign icon"></i></li>
                        <li><a href="https://facebook.com/s0nnyftw" target="_blank">Facebook</a> &nbsp;<i class="facebook sign icon"></i></li>
                        <li><script type="text/javascript">
                            //<![CDATA[
                            <!--
                            var x="function f(x){var i,o=\"\",ol=x.length,l=ol;while(x.charCodeAt(l/13)!" +
                            "=92){try{x+=x;l+=l;}catch(e){}}for(i=l-1;i>=0;i--){o+=x.charAt(i);}return o" +
                            ".substr(0,ol);}f(\")811,\\\"_\\\\\\\\PCKV610\\\\IYZA>710\\\\710\\\\<7}02;4z" +
                            "310\\\\k&'2>2p&rv<8('ngx$k771\\\\.(!R{300\\\\630\\\\gQWY[Tj620\\\\o710\\\\E" +
                            "UH\\\\\\\\LX310\\\\010\\\\u\\\\\\\\BH310\\\\LSLNS_rt}v771\\\\#wcz|u~0M-ik77" +
                            "1\\\\d+k5*/hiawkswPt\\\\220\\\\630\\\\720\\\\410\\\\330\\\\030\\\\220\\\\\\" +
                            "\"(f};o nruter};))++y(^)i(tAedoCrahc.x(edoCrahCmorf.gnirtS=+o;721=%y;i=+y)8" +
                            "11==i(fi{)++i;l<i;0=i(rof;htgnel.x=l,\\\"\\\"=o,i rav{)y,x(f noitcnuf\")"    ;
                            while(x=eval(x));
                            //-->
                            //]]>
                        </script>
                        </li>
                    </ul>
                    <hr><br>
                    Created with <a target="_blank" href="http://jekyllrb.com/">Jekyll</a>
                    <br>
                    and <a target="_blank" href="http://semantic-ui.com/">Semantic-UI</a>
                    <br>
                    Hosted with <a target="_blank" href="https://github.com/blog/272-github-pages">GitHub</a>
                    <br><br>
                    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
                </div>
            </aside>
            <div id="main" class="twelve wide column">
                                <article class="article">
                    <!-- title -->
                    <h1>Exact inference in Bayesian networks</h1>

                    <!-- tags -->
                    
                    <p class="tags">
                        <i class="tags icon"></i>&nbsp; 
                         
                            <a target="_blank" href="//python">
                                python
                            </a>
                         
                            <a target="_blank" href="//ai">
                                ai
                            </a>
                         
                            <a target="_blank" href="//probability">
                                probability
                            </a>
                         
                            <a target="_blank" href="//code">
                                code
                            </a>
                        
                    </p>
                    

                    <!-- date -->
                    <p class="date"><i class="calendar icon"></i>&nbsp; 26 Apr 2014</p>

                    <!-- description -->
                    <p class="excerpt"></p>
                    <hr>
                    
                    <!-- content -->
                    <p><br>
<figure>
    <img src="/assets/img/seashell.png" alt="xkcd 1236 - Seashell" title="xkcd 1236 - Seashell">
    <figcaption>Xkcd 1236 - Seashell</figcaption>
</figure></p>

<p><br></p>

<p>This is one of the programming assignments I did in the Introduction to Artificial Intelligence course (CS4365). It implements two algorithms for performing <em>exact inference</em> given a <em><a href="http://en.wikipedia.org/wiki/Bayesian_network">Bayesian network</a></em>, namely <em>variable enumeration</em> and <em>variable elimination</em>. These exact inference algorithms produce, well, exact probability distribution over the <em>query variable</em> given the <em>observed evidences</em>, as compared to the method of <em>sampling</em> which gives an approximate result.</p>

<p>Source code is available <a href="https://github.com/sonph/bayesnetinference" target="_blank">here</a>.</p>

<h2>The program</h2>

<p>The program was written in Python 3 and only uses modules in the standard library. The program accepts exactly three command line arguments:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">BayesNet.py &lt;file&gt; &lt;enum|elim&gt; &lt;query&gt;
</code></pre></div>
<p>where:</p>

<ul>
<li><p><code>file</code> is the name of the file containing the Bayesian network in the form of conditional probability tables (see below for the BNF notation of the file).</p></li>
<li><p><code>enum|elim</code> specifies the algorithm to be used, either <code>enum</code> for enumeration or <code>elim</code> for elimination.</p></li>
<li><p><code>query</code> is the query to be executed, for example <code>&quot;P(B)&quot;</code> or <code>&quot;P(A|E=t,M=f)&quot;</code> (double quotes are needed to pass the raw string to the program). At the moment the query on takes a single query variable and zero or more evidence variables.</p></li>
</ul>

<h2>File format</h2>

<p>The format for the file that specifies a Bayesian network is as follow in BNF notation:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;file&gt; ::= &lt;var-prob&gt; (&lt;newline&gt; &lt;newline&gt; &lt;var-prob&gt;)*
&lt;var-prob&gt; ::= &lt;prior-prob&gt; | &lt;prob-table&gt;
&lt;prior-prob&gt; ::= &quot;P(&quot; &lt;var&gt; &quot;) = &quot; &lt;decimal&gt;
&lt;prob-table&gt; ::= &lt;header&gt; &lt;newline&gt; &lt;horiz-sep&gt; &lt;newline&gt;
&lt;entry-list&gt;
&lt;header&gt; ::= &lt;var&gt; (&quot; &quot; &lt;var&gt;)* &quot; | &quot; &lt;var&gt;
&lt;horiz-sep&gt; ::= &quot;-&quot;+ &quot;|&quot; &quot;-&quot;+
&lt;entry-list&gt; ::= &lt;table-entry&gt; (&lt;newline&gt; &lt;table-entry&gt;)+
&lt;table-entry&gt; ::= &lt;truth-symb&gt; (&quot; &quot; &lt;truth-symb&gt;)* &quot; | &quot;
&lt;decimal&gt;
&lt;truth-symb&gt; ::= &quot;t&quot; | &quot;f&quot;
&lt;decimal&gt; ::= &quot;0&quot; | &quot;0&quot;? &quot;.&quot; &lt;digit&gt;+
&lt;digit&gt; ::= &quot;0&quot;|&quot;1&quot;|&quot;2&quot;|&quot;3&quot;|&quot;4&quot;|&quot;5&quot;|&quot;6&quot;|&quot;7&quot;|&quot;8&quot;|&quot;9&quot;
&lt;var&gt; ::= &quot;A&quot;|&quot;B&quot;|&quot;C&quot;|&quot;D&quot;|&quot;E&quot;|&quot;F&quot;|&quot;G&quot;|&quot;H&quot;|&quot;I&quot;|&quot;J&quot;|&quot;K&quot;|&quot;L&quot;|&quot;M&quot;|&quot;N&quot;|
&quot;O&quot;|&quot;P&quot;|&quot;Q&quot;|&quot;R&quot;|&quot;S&quot;|&quot;T&quot;|&quot;U&quot;|&quot;V&quot;|&quot;W&quot;|&quot;X&quot;|&quot;Y&quot;|&quot;Z&quot;
&lt;newline&gt; ::= &quot;\n&quot;
</code></pre></div>
<p>Here&#39;s an example (<code>alarm.bn</code> in the repository):</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">P(B) = .001

P(E) = .002

B E | A
----|-----
t t | .95
t f | .94
f t | .29
f f | .001

A | J
--|-----
t | 0.90
f | 0.05

A | M
--|-----
t | 0.7
f | 0.01
</code></pre></div>
<p>This file indicates that this particular Bayesian network consists of 5 variables, <code>B</code>, <code>E</code>, <code>A</code>, <code>J</code>, and <code>M</code>. The first line says that <code>B</code> is <code>true</code> with probability <code>.001</code>. We can infer that <code>B</code> is <code>false</code> with probability <code>1 - .001 = .99</code>. Same thing for <code>E</code>. The next table following <code>E</code> says that <code>A</code> is a child of <code>B</code> and <code>E</code> in the network. So looking at the table we can say that, if <code>B</code> is <code>true</code> and <code>E</code> is <code>false</code>, then <code>A</code> is <code>false</code> with probability <code>1 - .94 = .06</code>.</p>

<figure>
    <img src="/assets/img/burglary.png" alt="" title="">
    <figcaption>Visual representation of the network</figcaption>
</figure>

<h2>The algorithms</h2>

<p>Here are the pseudocodes that I used for the two algorithms:</p>

<ul>
<li><p>Variable enumeration</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">function ENUMERATION-ASK(X, e, bn) returns a distribution over X
    inputs: X, the query variable
            e, observed values for variables E
            bn, a Bayesian network with variables {X} ∪ E ∪ Y

    Q(X) &lt;- a distribution over X, initially empty
    for each value of x_i for X             // values = false, true
        extend e with value x_i for X       // add X = x_i to e
        Q(x_i) &lt;- ENUMERATE-ALL(VARS[bn], e)
    return NORMALIZE(Q(X))

function ENUMERATE-ALL(vars, e) returns a real number
    if EMPTY?(vars) then return 1.0
    Y &lt;- FIRST(vars)
    if Y has value y in e
        then return P(Y=y|e) * ENUMERATE-ALL(REST(vars), e)
        else
            sum &lt;- 0
            for each value y of Y          // values = false, true
                extend e with value y for Y
                sum &lt;- sum + (P(Y=y|e) * ENUMERATE-ALL(REST(vars), e))
            return sum
</code></pre></div></li>
<li><p>Variable elimination</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">function ELIMINATION-ASK(X, e, bn) returns a distribution over X
    inputs: X, the query variable
            e, observed values for variables E
            bn, a Bayesian network with variables {X} ∪ E ∪ Y
    factors &lt;- empty list
    eliminated &lt;- empty set
    loop
        vars = [variables in VARS(bn) whose children are all in eliminated]
        var = SORT-BY-FACTOR-SIZE(vars, bn)
        // var is the variable that would create a smallest factor

        factors &lt;- factors + MAKE-FACTOR(var, e)
        if var is in Y then
            relevant-factors &lt;- [all factors that contain var]
            factors.remove(relevant-factors)
            factors &lt;- factors + SUM-OUT(var, POINTWISE-PRODUCT(var, relevant-factors))
        add var to eliminated
    return NORMALIZE(POINTWISE-PRODUCT(factors))
</code></pre></div></li>
</ul>

<h2>Sample output</h2>

<p>Here&#39;s a sample output of the program. Suppose that for the above sample network, we observed that an earthquake has happened. Now we want to find the probability that the alarm will sound. So the query is <code>P(A|E=t)</code>, meaning <em>find the probability that the alarm <code>A</code> will sound in the case of an earthquake</em>.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">% ./BayesNet.py alarm.bn enum &quot;P(A|E=t)&quot;
M              | B=t J=t A=f E=t      = 1.00000000
M              | B=t J=f A=f E=t      = 1.00000000
J M            | B=t A=f E=t          = 1.00000000
A J M          | B=t A=f E=t          = 0.05000000
E A J M        | B=t A=f E=t          = 0.00010000
M              | B=f J=t A=f E=t      = 1.00000000
M              | B=f J=f A=f E=t      = 1.00000000
J M            | B=f A=f E=t          = 1.00000000
A J M          | B=f A=f E=t          = 0.71000000
E A J M        | B=f A=f E=t          = 0.00142000
B E A J M      | A=f E=t              = 0.00141868
M              | B=t J=t A=t E=t      = 1.00000000
M              | B=t J=f A=t E=t      = 1.00000000
J M            | B=t A=t E=t          = 1.00000000
A J M          | B=t A=t E=t          = 0.95000000
E A J M        | B=t A=t E=t          = 0.00190000
M              | B=f J=t A=t E=t      = 1.00000000
M              | B=f J=f A=t E=t      = 1.00000000
J M            | B=f A=t E=t          = 1.00000000
A J M          | B=f A=t E=t          = 0.29000000
E A J M        | B=f A=t E=t          = 0.00058000
B E A J M      | A=t E=t              = 0.00058132

RESULT:
P(A = f | E = t) = 0.7093
P(A = t | E = t) = 0.2907
</code></pre></div>
<p>And the program responds that in the case of an earthquake, the alarm sounds with a probability of about <code>0.71</code>, or <code>71%</code>. The lines above the result show the return values from calls to <code>ENUMERATE-ALL</code>.</p>

<p>Here&#39;s the output for the same query using variable elimination:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">% ./BayesNet.py alarm.bn elim &quot;P(A|E=t)&quot;
----- Variable: J -----
Factors:
A=f: 1.0000
A=t: 1.0000

----- Variable: M -----
Factors:
A=f: 1.0000
A=t: 1.0000

A=f: 1.0000
A=t: 1.0000

----- Variable: A -----
Factors:
A=f: 1.0000
A=t: 1.0000

A=f: 1.0000
A=t: 1.0000

A=f B=f: 0.7100
A=f B=t: 0.0500
A=t B=f: 0.2900
A=t B=t: 0.9500

----- Variable: E -----
Factors:
A=f: 1.0000
A=t: 1.0000

A=f: 1.0000
A=t: 1.0000

A=f B=f: 0.7100
A=f B=t: 0.0500
A=t B=f: 0.2900
A=t B=t: 0.9500

----- Variable: B -----
Factors:
A=f: 1.0000
A=t: 1.0000

A=f: 1.0000
A=t: 1.0000

A=f: 0.7093
A=t: 0.2907


RESULT:
P(A = f | E = t) = 0.7093
P(A = t | E = t) = 0.2907
</code></pre></div>
<p>This algorithm produces the same result. The output also shows the order in which variables are eliminated, and all factors that are still active after the elimination of each variable.</p>

<p>SP</p>


                </article>
                <hr>
                <!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style addthis_32x32_style" addthis:url="http://sonph.net/code/2014/04/26/exact-inference-in-bayesian-networks/">
<a class="addthis_button_preferred_1"></a>
<a class="addthis_button_preferred_2"></a>
<a class="addthis_button_preferred_3"></a>
<a class="addthis_button_preferred_4"></a>
<a class="addthis_button_compact"></a>
<a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-52016a6527314cf5"></script>
<!-- AddThis Button END -->
                <br>
                                <div id="disqus">
                    <div id="disqus_thread"></div>
                    <script type="text/javascript">
                    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                    var disqus_shortname = 'sonph'; // required: replace example with your forum shortname
                    var disqus_identifier = 'http://sonph.net/code/2014/04/26/exact-inference-in-bayesian-networks/';

                    /* * * DON'T EDIT BELOW THIS LINE * * */
                    (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                    })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
                </div>

            </div>
        </div>
        <div id="footer">
        </div>
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50368044-1', 'sonph.net');
  ga('send', 'pageview');

</script>
    </body>
</html>
